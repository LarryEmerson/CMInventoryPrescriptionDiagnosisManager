<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中药库存及开方诊疗系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            /* box-sizing: border-box; */
            font-family: "Microsoft YaHei", sans-serif;
            background-color: inherit;
            color: inherit;
        } 
        .body {
            padding: 10px;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        .container {
            width: 100%;
            margin: 10px  ;
            background-color: #1a1a1a;
            padding-top: 120px;
        }
        .module {
            /* margin: 20px 0;
            padding: 15px; */
            /* border: 1px solid #333333; */
            border-radius: 8px;
            /* background-color: #2d2d2d; */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: box-shadow 0.3s ease;
        }
         .module-tab {
                margin: 15px 0;
                padding: 5px 0 0 0 ;
            }
        .module:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .module-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            position: relative;
        }
        .edit-btn {
            position: absolute;
            top: -10px;
            right: 0;
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .edit-btn:hover {
            background-color: #3367d6;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .stats-card {
            padding: 15px;
            border: 1px solid #333333;
            border-radius: 8px;
            background-color: #2d2d2d;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .stats-summary {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .stats-summary p {
            margin: 0;
            padding: 0;
            background-color: transparent;
            border-radius: 0;
            font-size: 13px;
        }
        .form-group {
            margin: 10px 0;
            max-width: 100%;
            overflow-x: auto;
        }
        label {
            display: inline-block;
            width: 120px;
            text-align: right;
            margin-right: 10px;
        }
        input, select {
            padding: 8px 12px;
            width: 250px;
            max-width: 100%;
            border: 1px solid #444444;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
            background-color: #3d3d3d;
            color: #e0e0e0;
            box-sizing: border-box;
        }
        
        textarea {
            padding: 8px 12px;
            width: 100%;
            border: 1px solid #444444;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
            background-color: #3d3d3d;
            color: #e0e0e0;
            resize: vertical;
            min-height: 80px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4285f4;
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.3);
        }
        button {
            padding: 8px 16px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            background-color: #3367d6;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
            transform: translateY(-1px);
        }
        
        button:active {
            background-color: #2a56c6;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            transform: translateY(0);
        }
        
        button:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.5);
        }
        .warning-list {
            margin-top: 10px;
            padding: 15px;
            border: 1px solid #444444;
            border-radius: 8px;
            background-color: #2d2d2d;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            color: #d93025;
        }
        
        .warning-list:hover {
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        }
        .warning-text{
            font-size: 12px;
            color:#dc6259
        }
        .prescription-drug-item {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .drug-name {
            flex-grow: 1;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .drug-grams-input {
            width: 100px;
            padding: 6px 10px;
            border: 1px solid #444444;
            border-radius: 4px;
            background-color: #3d3d3d;
            color: #e0e0e0;
            font-size: 14px;
        }
        
        .delete-drug-btn {
            flex-grow: 0;
            width: auto;
            padding: 6px 12px;
            background-color: #ea4335;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .remaining-grams {
            color: #4CAF50;
            font-size: 14px;
            margin-right: 10px;
            width: 100px;
        }
        
        .delete-drug-btn:hover {
            background-color: #d33b2d;
        }
        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
        }
        .popup-content {
            background-color: #666;
            padding: 20px;
            border-radius: 8px;
            width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .popup-buttons {
            margin-top: 15px;
            text-align: right;
        }
        .popup-buttons button {
            margin-left: 10px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .popup-buttons button.delete-btn {
            background-color: #ff4444;
            color: white;
        }
        .popup-buttons button.delete-btn:hover {
            background-color: #ff0000;
        }
        .popup textarea {
            width: 100%;
            min-height: 200px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: Arial, sans-serif;
            resize: vertical;
        }
        .textarea-controls {
            margin-bottom: 8px;
            text-align: left;
        }
        .textarea-controls button {
            margin-right: 10px;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        .textarea-controls button:hover {
            background-color: #45a049;
        }
        .drug-option {
            padding: 8px;
            border: 1px solid #eee;
            border-radius: 4px;
            margin: 5px 0;
            cursor: pointer;
        }
        .drug-option:hover {
            background-color: #f5f5f5;
        }
        .tip-box {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 4px;
            color: white;
            display: none;
            z-index: 999;
        }
        
        /* 标题栏样式 */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: #2d2d2d;
            color: #e0e0e0;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            margin-bottom: 0;
            border: 1px solid #4285f4;
            border-bottom: none;
            position: fixed;
            top: 0;
            left: 10px;
            right: 10px;
            z-index: 1000;
        }
        
        .system-title {
            font-size: 20px;
            font-weight: bold;
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .header-buttons {
            display: flex;
            gap: 8px;
        }
        
        .header-buttons button {
            background-color: #4285f4;
            color: white;
            font-size: 14px;
            padding: 6px 12px;
            border: 1px solid #3367d6;
        }
        
        .header-buttons button:hover {
            background-color: #3367d6;
        }
        
        /* 响应式设计 - 适配移动端 */
        @media (max-width: 768px) {
            /* 容器适配 */
            .container {
                width: 100%;
                margin: 0px;
                padding: 0px;
            }
            
            /* 标题栏适配 */
            .header {
                padding: 12px;
                margin-bottom: 0;
            }
            
            .system-title {
                font-size: 18px;
            }
            
            .header-buttons button {
                font-size: 13px;
                padding: 5px 10px;
            }
            
            /* 网格布局改为单列 */
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .diagnosis-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            /* 模块适配 */
            .module {
                /* margin: 15px 0;
                padding: 15px; */
            }
             .module-tab {
                margin: 15px 0;
                padding: 5px 0 0 0 ;
            }
            /* 表单元素适配 */
            .form-group {
                margin: 15px 0;
            }
            
            label {
                display: block;
                width: 100%;
                text-align: left;
                margin-right: 0;
                margin-bottom: 5px;
                font-size: 14px;
            }
            
            input, select, textarea {
                width: 100%;
                padding: 8px;
                font-size: 14px;
            }
            
            /* 按钮样式 */
            button {
                padding: 8px 16px;
                font-size: 14px;
            }
            
            /* Tab标签适配 */
            .tab-content {
                padding: 15px;
            }
            
            .tab-btn {
                padding: 10px 14px;
                font-size: 13px;
            }
            
            /* 弹窗适配 */
            .popup-content {
                width: 95% !important;
                max-width: none;
                margin: 15px;
                padding: 15px;
            }
            
            /* 字体大小优化 */
            .module-title {
                font-size: 16px;
                margin-bottom: 15px;
            }
            
            /* 统计摘要响应式 */
            .stats-summary {
                flex-direction: row;
                gap: 6px;
            }
            
            .stats-summary p {
                font-size: 12px;
                padding: 3px 7px;
            }
            
            h3 {
                font-size: 15px;
            }
            
            h4 {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            /* 表格适配 */
            .drug-table {
                font-size: 13px;
            }
            
            .drug-table th, .drug-table td {
                padding: 6px;
            }
            
            /* 记录样式适配 */
            .stock-in-item, .record-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .drug-info {
                flex-direction: column;
                gap: 3px;
            }
            
            /* 药物选择项适配 */
            .drug-option {
                padding: 12px;
            }
            
            /* 诊疗日志布局优化 */
            .sleep-time-item {
                margin: 8px 0;
            }
            
            /* 提示框位置 */
            .tip-box {
                left: 10px;
                right: 10px;
                padding: 10px 15px;
            }
        }
        .tip-success {
            background-color: #34a853;
        }
        .tip-error {
            background-color: #d93025;
        }
        .diagnosis-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .sleep-time-item {
            margin: 5px 0;
        }
        /* 新增药物选择表格样式 */
        .drug-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            background-color: #2d2d2d;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            table-layout: fixed; /* 固定表格布局，确保表格宽度不超过父容器 */
            word-wrap: break-word; /* 允许单词换行 */
            word-break: break-all; /* 允许在任何字符处换行 */
        }
        
        .drug-table th, .drug-table td {
            border: 1px solid #444444;
            padding: 10px;
            text-align: left;
            font-size: 14px;
            color: #e0e0e0;
            white-space: normal; /* 允许正常换行 */
            overflow-wrap: break-word; /* 允许长单词或URL换行 */
        }
        
        /* 为备注列设置最大宽度 */
        .drug-table td:last-child, .drug-table th:last-child {
            max-width: 200px;
        }
        
        .drug-table th {
            background-color: #3d3d3d;
            font-weight: bold;
            color: #e0e0e0;
        }
        
        .drug-table tr {
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #2d2d2d;
        }
        
        .drug-table tr:hover {
            background-color: #3a3a3a;
        }
        
        .drug-table tr:nth-child(even) {
            background-color: #333333;
        }
        
        .drug-table tr:nth-child(even):hover {
            background-color: #3a3a3a;
        }
        /* 弹窗内容自适应表格 */
        .popup-content {
            width: 600px; /* 加宽弹窗适配表格 */
        }

        /* Tab标签样式 */
        .tab-container {
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
        }

        .tab-header {
            display: flex;
            background-color: #2d2d2d;
            border-bottom: 1px solid #444444;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            position: fixed;
            top: 50px;
            left: 10px;
            right: 10px;
            z-index: 1000;
        }

        .tab-btn {
            padding: 12px 16px;
            border: none;
            background-color: transparent;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 14px;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab-btn:hover {
            background-color: #3a3a3a;
        }

        .tab-btn.active {
            color: #4285f4;
            border-bottom-color: #4285f4;
            background-color: #2d2d2d;
        }

        .tab-content {
            padding: 15px;
            /* background-color: white; */
            margin-top: 90px;
        }

        .tab-panels-container {
            /* 传统的Tab实现方式，不需要flex布局 */
        }

        .tab-panel {
            display: none;
            width: 100%;
            min-height: 600px;
        }

        .tab-panel.active {
            display: block;
        }

        /* 入库记录样式 */
        .date-group {
            margin-bottom: 20px;
            border: 1px solid #eee;
            border-radius: 4px;
            overflow: hidden;
        }

        .date-header {
            /* background-color: #f5f5f5; */
            padding: 8px 15px;
            font-weight: bold;
            border-bottom: 1px solid #eee;
        }

        .stock-in-records {
            padding: 10px;
        }

        .stock-in-item {
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
            padding: 10px;
            border-bottom: 1px solid #444444;
        }

        .stock-in-item:last-child {
            border-bottom: none;
        }

        .stock-in-info {
            flex: 1;
            text-align: left;
        }

        .drug-info {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            margin-bottom: 5px;
            gap: 3px;
        }

        .drug-name {
            font-weight: bold;
        }

        .drug-amount {
            color: #b0b0b0;
        }

        .drug-unit-price {
            color: #b0b0b0;
            font-size: 14px;
        }

        .source-info {
            font-size: 14px;
            color: #b0b0b0;
        }

        .stock-in-details {
            margin-left: 15px;
            display: none;
        }

        /* 出库记录样式 */
        .stock-out-record {
            /* border: 1px solid #eee; */
            border-radius: 4px;
            margin-bottom: 0px;
            padding: 4px 4px;
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .record-time {
            font-weight: bold;
            color: #333;
        }

        .record-content {
            padding-left: 10px;
            border-left: 3px solid #4285f4;
        }

        .detail-btn {
            padding: 4px 8px;
            font-size: 12px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .detail-btn:hover {
            background-color: #3367d6;
        }

        .no-records {
            text-align: center;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body class="body">
<div class="container">
    <!-- 提示框 -->
    <div class="tip-box" id="tipBox"></div>
    
    <!-- 标题栏 -->
    <div class="header">
        <h1 class="system-title">中药诊疗管理系统</h1>
        <div class="header-buttons">
            <button id="restoreBtn">恢复</button>
            <button id="backupBtn">备份</button>
        </div>
    </div>

    <!-- 统计模块将被移动到新的tab标签中 -->

    <!-- Tab标签组件 -->
    <div class="module-tab">
        <div class="tab-container">
            <!-- Tab标签 -->
            <div class="tab-header">
                <button class="tab-btn" data-tab="statistics">统计</button>
                <button class="tab-btn" data-tab="prescription">开方</button>
                <button class="tab-btn" data-tab="stockOut">出库记录</button>
                <button class="tab-btn" data-tab="dataManager">数据管理</button>
                <button class="tab-btn" data-tab="processing">炮制</button>
                <button class="tab-btn" data-tab="stockIn">入库记录</button>
                <button class="tab-btn" data-tab="drugs">药物</button>
                <button class="tab-btn" data-tab="sources">来源</button>
            </div>

            <!-- Tab内容 -->
            <div class="tab-content">
                <div class="tab-panels-container">
                <!-- 统计标签内容 -->
                <div id="statistics" class="tab-panel active">
                    <div class="module">
                        <div class="module-title">数据统计</div>
                        <div class="stats-grid">
                            <div class="stats-card">
                                <h3>昨日统计</h3>
                                <div class="stats-summary">
                                    <p>总量：<span id="yesterdayTotalGrams">0</span>g</p>
                                    <p>种类：<span id="yesterdayTotalTypes">0</span>种</p>
                                    <p>总额：<span id="yesterdayTotalAmount">0</span>元</p>
                                </div>
                                <div>
                                    <h4>详情列表</h4>
                                    <table class="drug-table">
                                        <thead>
                                            <tr>
                                                <th>药物</th>
                                                <th>用量(g)</th>
                                                <th>金额(元)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="yesterdayDrugList"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="stats-card">
                                <h3>今日统计</h3>
                                <div class="stats-summary">
                                    <p>总量：<span id="todayTotalGrams">0</span>g</p>
                                    <p>种类：<span id="todayTotalTypes">0</span>种</p>
                                    <p>总额：<span id="todayTotalAmount">0</span>元</p>
                                </div>
                                <div>
                                    <h4>详情列表</h4>
                                    <table class="drug-table">
                                        <thead>
                                            <tr>
                                                <th>药物</th>
                                                <th>用量(g)</th>
                                                <th>金额(元)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="todayDrugList"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="warning-list">
                            <h3>预警列表  <span class="warning-text">共<span id="warningCount">0</span>种</span></h3>      
                            <table class="drug-table">
                                <thead>
                                    <tr>
                                        <th>药物</th>
                                        <th>库存(g)</th>
                                        <th>阈值(g)</th>
                                    </tr>
                                </thead>
                                <tbody id="warningDrugList"></tbody>
                        </table>
                    </div>
                    
                    <!-- 炮制和废弃药物统计 -->
                    <div class="module">
                        <div class="module-title">炮制和废弃药物统计</div>
                        <div class="stats-grid">
                            <div class="stats-card">
                                <h3>今日炮制统计</h3>
                                <p>药物种类: <span id="todayProcessingDrugCount">0</span></p>
                                <p>总克数: <span id="todayProcessingTotalGrams">0</span></p>
                                <p>总价值: <span id="todayProcessingTotalAmount">0</span>元</p>
                            </div>
                            <div class="stats-card">
                                <h3>今日废弃统计</h3>
                                <p>药物种类: <span id="todayDiscardDrugCount">0</span></p>
                                <p>总克数: <span id="todayDiscardTotalGrams">0</span></p>
                                <p>总价值: <span id="todayDiscardTotalAmount">0</span>元</p>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
                <!-- 炮制标签内容 -->
                <div id="processing" class="tab-panel">
                    <div class="module">
                        <div class="module-title">炮制管理 <button id="editProcessingBtn" class="edit-btn">编辑</button></div>
                        <div class="stats-grid">
                            <div class="stats-card">
                                <h3>本月炮制统计</h3>
                                <p>药物种类: <span id="monthlyProcessingDrugCount">0</span></p>
                                <p>总克数: <span id="monthlyProcessingTotalGrams">0</span></p>
                                <p>总价值: <span id="monthlyProcessingTotalAmount">0</span>元</p>
                            </div>
                            <div class="stats-card">
                                <h3>上月炮制统计</h3>
                                <p>药物种类: <span id="lastMonthProcessingDrugCount">0</span></p>
                                <p>总克数: <span id="lastMonthProcessingTotalGrams">0</span></p>
                                <p>总价值: <span id="lastMonthProcessingTotalAmount">0</span>元</p>
                            </div>
                        </div>
                        
                        <div class="processing-list">
                            <h3>炮制记录</h3>
                            <table class="drug-table">
                                <thead>
                                    <tr>
                                        <th>药物名称</th>
                                        <th>克数</th>
                                        <th>价值</th>
                                        <th>时间</th>
                                    </tr>
                                </thead>
                                <tbody id="processingRecords">
                                    <!-- 炮制记录内容将通过JavaScript动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- 开方标签内容 -->
                <div id="prescription" class="tab-panel">
                    <div class="module">
                        <div class="module-title">开方管理</div>
                        <h4>上次记录</h4>
                        <div id="prescriptionDrugList"></div>
                        <button id="addDrugToPresBtn">新增药物到开方</button>

                        <!-- 药物选择弹窗 -->
                        <div class="popup" id="drugSelectPopup">
                            <div class="popup-content">
                                <h3>选择药物</h3>
                                <div id="selectableDrugList"></div>
                                <button id="closePopupBtn">关闭</button>
                            </div>
                        </div>







                        <!-- 诊疗日志录入 -->
                        <div class="module" style="margin-top: 20px;">
                            <div class="module-title">诊疗日志录入</div>
                            <div class="diagnosis-grid">
                                <!-- 第1列：尿液情况 + 运动情况 -->
                                <div>
                                    <h4>尿液情况</h4>
                                    <div class="form-group">
                                        <label for="nightUrineVolume">夜尿尿量：</label>
                                        <select id="nightUrineVolume">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="nightUrineFoam">夜尿泡沫：</label>
                                        <select id="nightUrineFoam">
                                            <option value="有">有</option>
                                            <option value="无">无</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="nightUrineColor">夜尿颜色：</label>
                                        <select id="nightUrineColor">
                                            <option value="白">白</option>
                                            <option value="黄">黄</option>
                                            <option value="橙赤">橙赤</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="nightUrineDeposit">夜尿沉淀量：</label>
                                        <select id="nightUrineDeposit">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="nightUrineDepositColor">沉淀颜色：</label>
                                        <select id="nightUrineDepositColor">
                                            <option value="白">白</option>
                                            <option value="黄">黄</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="shortUrineVolume">短尿尿量：</label>
                                        <select id="shortUrineVolume">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="shortUrineColor">短尿颜色：</label>
                                        <select id="shortUrineColor">
                                            <option value="白">白</option>
                                            <option value="黄">黄</option>
                                            <option value="橙赤">橙赤</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="shortUrineRemark">短尿备注：</label>
                                        <textarea id="shortUrineRemark" rows="2"></textarea>
                                    </div>
                                    <h4>大便情况</h4>
                                    <div class="form-group">
                                        <label for="stoolColor">大便颜色：</label>
                                        <select id="stoolColor">
                                            <option value="黄色">黄色</option>
                                            <option value="褐色">褐色</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="stoolShape">大便形状：</label>
                                        <select id="stoolShape">
                                            <option value="稍成型">稍成型</option>
                                            <option value="不成形糊状">不成形糊状</option>
                                            <option value="不成形絮状">不成形絮状</option>
                                            <option value="成型">成型</option>
                                        </select>
                                    </div>

                                    <h4>运动情况</h4>
                                    <div class="form-group">
                                        <label for="exerciseMorning">早晨：</label>
                                        <select id="exerciseMorning">
                                            <option value="无">无</option>
                                            <option value="步行">步行</option>
                                            <option value="八段锦">八段锦</option>
                                            <option value="金刚功">金刚功</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="exerciseNoon">中午：</label>
                                        <select id="exerciseNoon">
                                            <option value="无">无</option>
                                            <option value="步行">步行</option>
                                            <option value="八段锦">八段锦</option>
                                            <option value="金刚功">金刚功</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="exerciseEvening">晚上：</label>
                                        <select id="exerciseEvening">
                                            <option value="无">无</option>
                                            <option value="步行">步行</option>
                                            <option value="八段锦">八段锦</option>
                                            <option value="金刚功">金刚功</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- 第2列：睡眠情况 + 其他情况 -->
                                <div> 
                                    <h4>睡眠情况</h4>
                                    <div class="form-group">
                                        <label for="sleepNoon">午间：</label>
                                        <select id="sleepNoon" class="sleep-select">
                                            <option value="无睡眠">无睡眠</option>
                                            <option value="似睡非睡">似睡非睡</option>
                                            <option value="浅睡">浅睡</option>
                                            <option value="多梦">多梦</option>
                                            <option value="沉睡">沉睡</option>
                                        </select>
                                    </div>
                                    <div class="form-group sleep-time-item">
                                        <label for="sleep9">晚9点：</label>
                                        <select id="sleep9" class="sleep-select">
                                            <option value="无睡眠">无睡眠</option>
                                            <option value="似睡非睡">似睡非睡</option>
                                            <option value="浅睡">浅睡</option>
                                            <option value="多梦">多梦</option>
                                            <option value="沉睡">沉睡</option>
                                        </select>
                                    </div>
                                    <div class="form-group sleep-time-item">
                                        <label for="sleep10">晚10点：</label>
                                        <select id="sleep10" class="sleep-select">
                                            <option value="无睡眠">无睡眠</option>
                                            <option value="似睡非睡">似睡非睡</option>
                                            <option value="浅睡">浅睡</option>
                                            <option value="多梦">多梦</option>
                                            <option value="沉睡">沉睡</option>
                                        </select>
                                    </div>
                                    <div class="form-group sleep-time-item">
                                        <label for="sleep11">晚11点：</label>
                                        <select id="sleep11" class="sleep-select">
                                            <option value="无睡眠">无睡眠</option>
                                            <option value="似睡非睡">似睡非睡</option>
                                            <option value="浅睡">浅睡</option>
                                            <option value="多梦">多梦</option>
                                            <option value="沉睡">沉睡</option>
                                        </select>
                                    </div>
                                    <div class="form-group sleep-time-item">
                                        <label for="sleep12">夜12点：</label>
                                        <select id="sleep12" class="sleep-select">
                                            <option value="无睡眠">无睡眠</option>
                                            <option value="似睡非睡">似睡非睡</option>
                                            <option value="浅睡">浅睡</option>
                                            <option value="多梦">多梦</option>
                                            <option value="沉睡">沉睡</option>
                                        </select>
                                    </div>
                                    <div class="form-group sleep-time-item">
                                        <label for="sleep1">凌晨1点：</label>
                                        <select id="sleep1" class="sleep-select">
                                            <option value="无睡眠">无睡眠</option>
                                            <option value="似睡非睡">似睡非睡</option>
                                            <option value="浅睡">浅睡</option>
                                            <option value="多梦">多梦</option>
                                            <option value="沉睡">沉睡</option>
                                        </select>
                                    </div>
                                    <div class="form-group sleep-time-item">
                                        <label for="sleep2">凌晨2点：</label>
                                        <select id="sleep2" class="sleep-select">
                                            <option value="无睡眠">无睡眠</option>
                                            <option value="似睡非睡">似睡非睡</option>
                                            <option value="浅睡">浅睡</option>
                                            <option value="多梦">多梦</option>
                                            <option value="沉睡">沉睡</option>
                                        </select>
                                    </div>
                                    <div class="form-group sleep-time-item">
                                        <label for="sleep3">凌晨3点：</label>
                                        <select id="sleep3" class="sleep-select">
                                            <option value="无睡眠">无睡眠</option>
                                            <option value="似睡非睡">似睡非睡</option>
                                            <option value="浅睡">浅睡</option>
                                            <option value="多梦">多梦</option>
                                            <option value="沉睡">沉睡</option>
                                        </select>
                                    </div>
                                    <div class="form-group sleep-time-item">
                                        <label for="sleep4">凌晨4点：</label>
                                        <select id="sleep4" class="sleep-select">
                                            <option value="无睡眠">无睡眠</option>
                                            <option value="似睡非睡">似睡非睡</option>
                                            <option value="浅睡">浅睡</option>
                                            <option value="多梦">多梦</option>
                                            <option value="沉睡">沉睡</option>
                                        </select>
                                    </div>
                                    <div class="form-group sleep-time-item">
                                        <label for="sleep5">凌晨5点：</label>
                                        <select id="sleep5" class="sleep-select">
                                            <option value="无睡眠">无睡眠</option>
                                            <option value="似睡非睡">似睡非睡</option>
                                            <option value="浅睡">浅睡</option>
                                            <option value="多梦">多梦</option>
                                            <option value="沉睡">沉睡</option>
                                        </select>
                                    </div>
                                    <div class="form-group sleep-time-item">
                                        <label for="sleep6">早6点：</label>
                                        <select id="sleep6" class="sleep-select">
                                            <option value="无睡眠">无睡眠</option>
                                            <option value="似睡非睡">似睡非睡</option>
                                            <option value="浅睡">浅睡</option>
                                            <option value="多梦">多梦</option>
                                            <option value="沉睡">沉睡</option>
                                        </select>
                                    </div>
                                    <div class="form-group sleep-time-item">
                                        <label for="sleep7">早7点：</label>
                                        <select id="sleep7" class="sleep-select">
                                            <option value="无睡眠">无睡眠</option>
                                            <option value="似睡非睡">似睡非睡</option>
                                            <option value="浅睡">浅睡</option>
                                            <option value="多梦">多梦</option>
                                            <option value="沉睡">沉睡</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="sleepAssist">睡眠辅助：</label>
                                        <input type="text" id="sleepAssist" placeholder="洗脚、热水袋等">
                                    </div>

                                    <h4>其他情况</h4>
                                    <div class="form-group">
                                        <label for="morningWeak">晨起无力：</label>
                                        <select id="morningWeak">
                                            <option value="是">是</option>
                                            <option value="否">否</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="dietBloating">腹胀：</label>
                                        <select id="dietBloating">
                                            <option value="是">是</option>
                                            <option value="否">否</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="dietAbdominalPain">腹痛：</label>
                                        <select id="dietAbdominalPain">
                                            <option value="是">是</option>
                                            <option value="否">否</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="dietAppetite">无食欲：</label>
                                        <select id="dietAppetite">
                                            <option value="是">是</option>
                                            <option value="否">否</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="hasDiarrhea">腹泻：</label>
                                        <select id="hasDiarrhea">
                                            <option value="是">是</option>
                                            <option value="否">否</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="otherRemark">其他备注：</label>
                                        <textarea id="otherRemark" rows="3"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 提交开方按钮 -->
                        <button id="submitPrescriptionBtn" style="margin-top: 20px; font-size: 16px;">提交开方并保存诊疗日志</button>
                    </div>
                </div>

                <!-- 出库记录标签内容 -->
                <div id="stockOut" class="tab-panel">
                    <div class="module">
                        <div class="module-title">出库记录 <button id="editStockOutBtn" class="edit-btn">编辑</button></div>
                        <div id="stockOutList"></div>
                    </div>
                </div>

                <!-- 数据管理标签内容 -->
                <div id="dataManager" class="tab-panel">
                    <div class="module">
                        <div class="module-title">数据管理</div>

                        <!-- 新增来源 -->
                        <div class="form-group">
                            <h4>新增药物来源</h4>
                            <label for="sourceName">来源名称：</label>
                            <input type="text" id="sourceName" placeholder="输入来源名称">
                            <label for="sourceRemark">来源备注：</label>
                            <input type="text" id="sourceRemark" placeholder="输入来源备注">
                            <button id="addSourceBtn">新增来源</button>
                            <button id="batchAddSourceBtn">批量新增</button>
                        </div>

                        <!-- 新增药物 -->
                        <div class="form-group">
                            <h4>新增中药药物</h4>
                            <label for="drugName">药物名称：</label>
                            <input type="text" id="drugName" placeholder="输入药物名称">
                            <label for="storageType">存储方式：</label>
                            <select id="storageType">
                                <option value="密封">密封</option>
                                <option value="冷藏">冷藏</option>
                            </select>
                            <label for="minStock">预警阈值(g)：</label>
                            <input type="number" id="minStock" min="0" step="1" value="100">
                            <label for="defaultEstimate">默认预估量(g)：</label>
                            <input type="number" id="defaultEstimate" min="1" step="1" value="10">
                            <button id="addDrugBtn">新增药物</button>
                            <button id="batchAddDrugBtn">批量新增</button>
                        </div>

                        <!-- 新增入库 -->
                        <div class="form-group">
                            <h4>药物入库</h4>
                            <label for="stockInDrug">选择药物：</label>
                            <select id="stockInDrug"></select>
                            <label for="stockInSource">选择来源：</label>
                            <select id="stockInSource"></select>
                            <label for="stockInGrams">入库克数(g)：</label>
                            <input type="number" id="stockInGrams" min="1" step="1" value="500">
                            <label for="stockInAmount">入库总金额(元)：</label>
                            <input type="number" id="stockInAmount" min="0.01" step="0.01" value="100.00">
                            <label for="stockInRemark">入库备注：</label>
                            <input type="text" id="stockInRemark" placeholder="输入入库备注">
                            <button id="addStockInBtn">确认入库</button>
                            <button id="batchStockInBtn">批量入库</button>
                        </div>
                    </div>
                </div>

                <!-- 入库记录标签内容 -->
                <div id="stockIn" class="tab-panel">
                    <div class="module">
                        <div class="module-title">入库记录 <button id="editStockInBtn" class="edit-btn">编辑</button></div>
                        <div id="stockInList"></div>
                    </div>
                </div>

                <!-- 药物标签内容 -->
                <div id="drugs" class="tab-panel">
                    <div class="module">
                        <div class="module-title">药物列表 <button id="editDrugsBtn" class="edit-btn">编辑</button></div>
                        <table class="drug-table">
                            <thead>
                                <tr>
                                    <th>名称</th>
                                    <th>存储方式</th>
                                    <th>预警阈值(g)</th>
                                    <th>预估量(g)</th>
                                </tr>
                            </thead>
                            <tbody id="drugTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- 来源标签内容 -->
                <div id="sources" class="tab-panel">
                    <div class="module">
                        <div class="module-title">来源列表 <button id="editSourcesBtn" class="edit-btn">编辑</button></div>
                        <table class="drug-table">
                            <thead>
                                <tr>
                                    <th>名称</th>
                                    <th>备注</th>
                                </tr>
                            </thead>
                            <tbody id="sourceTableBody"></tbody>
                        </table>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 批量操作弹窗（移到所有tab面板的外部，确保始终可访问） -->
    <!-- 批量新增来源弹窗 -->
    <div class="popup" id="batchSourcePopup">
        <div class="popup-content">
            <h3>批量新增药物来源</h3>
            <p>格式：名称 备注（空格区分字段，回车区分记录）</p> 
            <textarea id="batchSourceText" rows="10" placeholder="请输入批量数据"></textarea>
            <div class="popup-buttons">
                <button id="clearAllSourceBtn" class="delete-btn">删除全部</button>
                <button id="confirmBatchSourceBtn">确认</button>
                <button id="closeBatchSourceBtn">关闭</button>
            </div>
        </div>
    </div>

    <!-- 批量新增药物弹窗 -->
    <div class="popup" id="batchDrugPopup">
        <div class="popup-content">
            <h3>批量新增中药药物</h3>
            <p>格式：名称 存储方式 预警阈值 默认预估量（空格区分字段，回车区分记录）</p> 
            <textarea id="batchDrugText" rows="10" placeholder="请输入批量数据"></textarea>
            <div class="popup-buttons">
                <button id="clearAllDrugBtn" class="delete-btn">删除全部</button>
                <button id="confirmBatchDrugBtn">确认</button>
                <button id="closeBatchDrugBtn">关闭</button>
            </div>
        </div>
    </div>

    <!-- 批量入库弹窗 -->
    <div class="popup" id="batchStockInPopup">
        <div class="popup-content">
            <h3>批量药物入库</h3>
            <p>格式：药物名称 来源名称 克数 总金额 备注（空格区分字段，回车区分记录）</p> 
            <textarea id="batchStockInText" rows="10" placeholder="请输入批量数据"></textarea>
            <div class="popup-buttons">
                <button id="clearAllStockInBtn" class="delete-btn">清除入库记录</button>
                <button id="confirmBatchStockInBtn">确认</button>
                <button id="closeBatchStockInBtn">关闭</button>
            </div>
        </div>
    </div>
</div>

<!-- 引入JS文件（按依赖顺序） -->
<script src="db-manager.js"></script>
<script src="source-manager.js"></script>
<script src="drug-manager.js"></script>
<script src="stock-in-manager.js"></script>
<script src="stock-out-manager.js"></script>
<script src="diagnosis-log-manager.js"></script>
<script src="prescription-manager.js"></script>
<script src="stats-manager.js"></script>
<script src="app.js"></script>
</body>
</html>